# 一、数据类型及要求

| 数据类型 | 描述及要求                                                                                                                                |
| :------- | :---------------------------------------------------------------------------------------------------------------------------------------- |
| BYTE     | 无符号单字节整型（字节，8 位）                                                                                                            |
| WORD     | 无符号单字节整型（字节，16 位）                                                                                                           |
| DWORD    | 无符号单字节整型（字节，32 位）                                                                                                           |
| BYTE[n]  | n 字节                                                                                                                                    |
| STRING   | ASCII 字符码，若无数据则放一个 0 终结符，编码表示参见 GB/T 1988 所述含汉字时，采用区位码编码，占用 2 个字节，编码表示参见 GB 18030 所述。 |

##  二、数据包结构和定义

### 一个完整的数据包应由起始符、命令单元、识别码、数据加密方式、数据单元长度、数据单元和校验码组成，数据包结构和定义如下表所示。

| 起始字节   | 定义             | 数据类型 | 描述及要求                                                                                                                                                                   | 备注        |
| :--------- | :--------------- | :------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------- |
| 0          | 起始符           | STRING   | 固定为 ASCII 字符‘##’，用“0x23                                                                                                                                               | 0x23”表示。 |  |
| 2          | 命令标识         | BYTE     | 命令表示定义见 3.1                                                                                                                                                           | 命令单元    |
| 3          | 应答标志         | BYTE     | 应答标志定义见 3.2                                                                                                                                                           | 命令单元    |
| 4          | 唯一标识码       | STRING   | 当传输车辆数据时，应使用车辆 VIN，其字码应符合 GB16735 的规定，如传输其他数据，则  使用唯一自定义编码                                                                        |
| 21         | 数据单元加密方式 | BYTE     | 0x01：数据不加密；0x02：数据经过 RSA 算法加密；0x03:数据经过 AES128 位算法加密；“0xFE”表示异 常，“0xFF”表示无效，其他预留。                                                  |             |
| 22         | 数据单位长度     | WORD     | 数据单元长度是数据单元的总字节数，有效值范围：0 ～ 65531。                                                                                                                   |             |
| 24         | 数据单元         | -        | 数据单元格式和定义所在文件见下表                                                                                                                                             |
| 倒数第一位 | 校验码           | BYTE     | 采用 BCC（异或校验）法，校验范围从命令单元的第一个字节开始，同后一字结异或，直到校验码前一字节  为止，校验码占用一个字节，当数据单元存在加密时，应先加密后校验，先校验后解密 |

---

## 三、命令单元说明

### 3.1 命令标识

| 编码      | 定义               | 方向   | 查询文件                  |
| :-------- | :----------------- | :----- | :------------------------ |
| Ox01      | 车辆登入           | 上行   | fvehicleLogin.csv 或 4.1  |
| Ox02      | 实时信息上报       | 上行   | messageReport.csv 或 4.2  |
| Ox03      | 补发信息上报       | 上行   | supMessage.csv            |
| Ox04      | 车辆登出           | 上行   | vehicleLogout.csv 或 4.3  |
| Ox05      | 平台登入           | 上行   | platformLogin.csv 或 4.4  |
| Ox06      | 平台登出           |  上行  | platformLogout.csv 或 4.5 |
| Ox07      | 心跳               | 上行   | palpitation.csv           |
| Ox08      | 终端校时           | 上行   | timing.csv                |
| Ox09~Ox7F | 上行数据系统预留   | 上行   | updata.csv                |
| Ox80      | 查询命令           | 上行   | scarch.csv                |
| Ox81      | 设置命令           | 上行   | set.csv                   |
| Ox82      | 车载终端控制命令   | 下行   | control.csv               |
| Ox83~OxBF | 下行数据系统预留   | 下行   | downdata.csv              |
| OxCO~OxFE | 平台交换自定义数据 | 自定义 | exchange.csv              |

### 3.2 应答标志定义

| 编码 | 定义     | 说明                           |
| :--- | :------- | :----------------------------- |
| Ox01 | 成功     | 接收到信息正确                 |
| Ox02 | 错误     | 设置未成功                     |
| Ox03 | VIN 重复 | VIN 重复错误                   |
| OxFE |  命令    | 表示数据包为命令包，而非应答包 |

### 3.3 时间定义

| 数据表示内容 | 长度（字节） | 数据类型 | 有效值范围 |
| :----------- | :----------- | :------- | :--------- |
| 年           | 1            | BYTE     | 0~99       |
| 月           | 1            | BYTE     | 0~12       |
| 日           | 1            | BYTE     | 0~31       |
| 小时         | 1            | BYTE     | 0~24       |
| 分钟         | 1            | BYTE     | 0~59       |
| 秒           | 1            | BYTE     | 0~59       |

## 四、数据单元格式和定义

### 4.1  车辆登入

| 数据表示内容           | 长度/字节 | 数据类型 | 描述及要求                                                                          |
| :--------------------- | :-------- | :------- | :------------------------------------------------------------------------- |
| 数据采集时间           | 6         | BYET[6]  | 时间定义表见 3.3 时间定义                                                           |
| 登入流水号             | 2         | WORD     | 车载终端每登入一次登入流水号自动加 1，从 1 开始循环累加，最大值 65531，循环周期为天       |
| ICCID                  | 20        | STRING   | SIM 卡 ICCID 号（ICCID 应为终端从 SIM 卡获取的值，不应该人为填写或修改）            |
| 可充电储能子系统数     | 1         | BYTE     | 可充电储能子系统数 n，有效值范围：0~250                                             |
| 可充电储能系统编码长度 | 1         | BYTE     | 可充电储能系统编码长度 m，有效值范围：0~50，“0”表示不上传该编码                     |
| 可充电储能系统编码     | n\*m      | STRING   | 可充电储能系统编码宜为终端从车辆获取的值                                            |

### 4.2 实时信息上报

#### 4.2.1 实时信息上报格式

| 数据表示内容      | 长度/字节 | 数据类型 | 描述及要求                           |
| :---------------- | :-------- | :------- | :----------------------------------- |
| 数据采集时间      | 6         | BYTE[6]  | 时间定义表见 3.3                     |
| 信息类型标志（1） | 1         | BYTE     | 信息类型标志类型见下表 4.2.2         |
| 信息体（1）       | -         | BYTE     | 根据信息类型不同，长度和数据类型不同 |
| ......            | -         | -        | ......                               |
| 信息类型标志（n） | 1         | BYTE     | 信息类型标志类型见下表 4.2.2         |
| 信息体（n）       | -         | -        | 根据信息类型不同，长度和数据类型不同 |

#### 4.2.2 信息类型标志

| 类型编码  | 说明                   | 备注                                       |
| :-------- | :--------------------- | :----------------------------------------- |
| 0x01      | 整车数据               | 见下表 4.2.A                               |
| 0x02      | 驱动电机数据           | 见下表 4.2.B，且停车充电过程无需传递该数据 |
| 0x03      | 燃料电池数据           | 见下表 4.2.C                               |
| 0x04      | 发动机数据             | 见下表 4.2.D，且停车充电过程无需传递该数据 |
| 0x05      | 车辆位置数据           | 见下表 4.2.E                               |
| 0x06      | 极值数据               | 见下表 4.2.F                               |
| 0x07      | 报警数据               | 见下表 4.2.G                               |
| 0x08~0x09 | 终端数据预留           | --                                         |
| 0x0A~0x2F | 平台交换协议自定义数据 | --                                         |
| 0x30~0x7F | 预留                   | --                                         |
| 0x80~0xFE | 用户自定义             | 见下表 4.2.H                               |

#### 4.2.A 整车数据

| 英文         | 中文           | 字节 | 类型 | 有效值范围   | 分辨率  | 偏移量 | 异常       | 无效       | 其他                                                                                               |
| :----------- | :------------- | :--- | :--- | :----------- | :------ | :----- | :--------- | :--------- | :------------------------------------------------------------------------------------------------- |
| status       | 车辆状态       | 1    | enum |              |         |        | OxFE       | OxFF       | 1:ON//启动,2:OFF//熄火,3:OTHER                                                                     |
| chargeStatus | 充电状态       | 1    | enum |              |         |        | OxFE       | OxFF       | 1：PARK_CHARGING//停车充电,2:MOVE_CHARGING//行驶充电,3：UNCHARGED//未充电状态,4：COMPETE//充电完成 |
| mode         | 运行模式       | 1    | enum |              |         |        | OxFE       | OxFF       | "1:ELECTRIC// 电动,2:MIXED// 混动,3:FUEL//燃油"                                                    |
| speed        | 车速           | 2    | num  | 0 ~220       | 0.1km/h |        | OxFFFE     | OxFFFF     |
| mileage      | 累计里程       | 4    | num  | 0 ～ 9999999 | 0.1km   |        | OxFFFFFFFE | OxFFFFFFFF |
| voltage      | 总电压         | 2    | num  | 0 ～ 10000   | 0.1V    |        | OxFFFE     | OxFF       |
| current      | 总电流         | 2    | num  | 0~20000      | 0.1A    | 1000   | OxFFFE     | OxFF       |
| soc          | SOC            | 1    | num  | 0~100        | 1%      |        | OxFE       | OxFF       |
| dcStatus     | DC-OC 状态     | 1    | num  |              |         |        | OxFE       | OxFF       | "1: ""ON"" // 工作 2: ""OFF"" // 断开"                                                             |
| shift        | 档位           | 1    | enum |              |         |        | OxFE       | OxFF       |
| resistance   | 绝缘电阻       | 2    | num  | 0~60000      | 1kΩ     |        | OxFFFE     | OxFFFF     |
| aptv         | 加速踏板行程值 | 1    | num  | 0~100        | 1%      |        | OxFE       | OxFF       |
| break        | 制动踏板状态   | 1    | num  | 0~100        | 1%      |        | OxFE       | OxFF       | 用 0 表示制动关的状态，Ox65 即 101 表示制动状态                                                    |

#### 4.2.B 驱动电机数据

| 英文   | 中文                 | 字节                     | 类型 | 有效值范围 | 分辨率 | 偏移量 | 异常 | 无效 | 其他                       |
| :----- | :------------------- | :----------------------- | :--- | :--------- | :----- | :----- | :--- | :--- | :------------------------- |
| count  | 驱动电机个数         | 1                        | num  | 1~253      |        |        |      |      |
| motors | 驱动电机总成信息列表 | 每个驱动电机总成信息长度 |      |            |        |        |      |      | 见下表每个驱动电机信息数据 |

#### 4.B.1 每个驱动电机数据

| 英文        | 中文                   | 字节 | 类型 | 有效值范围 | 分辨率 | 偏移量 | 异常   | 无效   | 其他                                                                                         |
| :---------- | :--------------------- | :--- | :--- | :--------- | :----- | :----- | :----- | :----- | :------------------------------------------------------------------------------------------- |
| no          | 驱动电机序号           | 1    | num  | 1~253      |        |        |        |        |
| status      | 驱动电机状态           | 1    | enum |            |        |        | OxFE   | OxFF   | "1：""CONSUMPTION""//耗电，2:""GENERATION""//发电，3：""OFF""//关闭状态，4：""READY""//准备" |
| controlTemp | 驱动电机控制器温度     | 1    | num  | 0~250      | 1℃     | 40     | OxFE   | OxFF   |
| speed       | 驱动电机转速           | 2    | num  | 0~65531    | 1r/min | 20000  | OxFFFE | OxFFFF |
| torque      | 驱动电机转矩           | 2    | num  | 0~65531    | 0.1N·m | 20000  | OxFFFE | OxFFFF |
| temp        | 驱动电机温度           | 1    | num  | 0~250      | 1℃     | 40     | OxFE   | OxFF   |
| voltage     | 电机控制器输入电压     | 2    | num  | 0~60000    | 0.1V   |        | OxFFFE | OxFFFF |
| current     | 电机控制器直线母线电流 | 2    | num  | 0~20000    | 0.1A   | 1000   | OxFFFE | OxFFFF |

#### 4.2.C 燃料电池数据

| 英文            | 中文                   | 字节 | 类型 | 有效值范围 | 分辨率 | 偏移量 | 异常   | 无效   | 其他             |
| :-------------- | :--------------------- | :--- | :--- | :--------- | :----- | :----- | :----- | :----- | :--------------- |
| voltage         | 燃料电池电压           | 2    | num  | 0~20000    | 0.1V   |        | OxFFFE | OxFFFF |
| current         | 燃料电池电流           | 2    | num  | 0~20000    | 0.1A   |        | OxFFFE | OxFFFF |
| conRate         | 燃料消耗率             | 2    | num  | 0~60000    |        |        | OxFFFE | OxFFFF |
| probeCount      | 燃料电池温度探针总数   | 2    | num  | 0~65531    |        |        | OxFFFE | OxFFFF |
| ntcs            | 探针温度值             | 1\*N | num  | 0~240      |        | 40     | OxFE   | OxFF   |
| maxNtc          | 氢系统中最高温度       | 2    | num  | 0~2400     | 0.1℃   | 40     | OxFFFE | OxFFFF |
| maxNtcNo        | 氢气最高温度传感器代号 | 1    | num  | 1~252      |        |        | OxFE   | OxFF   |
| hcOfh           | 氢气最高浓度           | 2    | num  | 0~60000    | 1mg/kg |        | OxFFFE | OxFFFF |
| hcOfhNo         | 氢气最高浓度传感器代号 | 1    | num  | 1~252      |        |        | OxFE   | OxFF   |
| maxVoltageOfh   | 氢气最高压力           | 2    | num  | 0~1000     | 0.1MPa |        | OxFFFE | OxFFFF |
| maxVoltageOfhNo | 氢气最高压力传感器代号 | 1    | num  | 1~252      |        |        | OxFE   | OxFF   |
| dc              | 高压 DC/DC 状态        | 1    | enum |            |        |        | OxFE   | OxFF   | 01:工作；02 断开 |

#### 4.2.D 发动机数据

| 英文    | 中文       | 字节 | 类型 | 有效值范围 | 分辨率      | 偏移量 | 异常   | 无效   | 其他                          |
| :------ | :--------- | :--- | :--- | :--------- | :---------- | :----- | :----- | :----- | :---------------------------- |
| state   | 发动机状态 | 1    | enum |            |             |        | OxFE   | OxFF   | Ox01:启动状态；Ox02：关闭状态 |
| csSpeed | 曲轴转速   | 2    | num  | 0~60000    | 1r/min      |        | OxFFFE | OxFFFF |
| fcRate  | 燃料消耗率 | 2    | num  | 0~60000    | 0.01L/100km |        | OxFFFE | OxFFFF |

#### 4.2.E 车辆位置数据

| 英文  | 中文     | 字节 | 类型 | 有效值范围 | 分辨率 | 偏移量 | 异常       | 无效       | 其他                                             |
| :---- | :------- | :--- | :--- | :--------- | :----- | :----- | :--------- | :--------- | :----------------------------------------------- |
| state | 定义状态 | 1    |      |            |        |        | OxFE       | OxFF       | 见状态位定位                                     |
| lng   | 经度     | 4    |      |            |        |        | OxFFFFFFFE | OxFFFFFFFF | "以度为单位的纬度值乘以 10^6,精度到万分之一度。" |
| lat   | 纬度     | 4    |      |            |        |        | OxFFFFFFFE | OxFFFFFFFF | "以度为单位的经度值乘以 10^6,精度到万分之一度。" |

| 状态位定位 |                                                                                                                  |
| :--------- | :--------------------------------------------------------------------------------------------------------------- |
| 0          | 0：有效定位；1：无效定位（当数据通信正常而不能获取定位信信息时，发送最后一次有效定位信息，并将定位状态置为无效） |
| 1          | 0：北纬；1：南纬                                                                                                 |
| 2          | 0：东经；1：西经                                                                                                 |
| 3~7        | 保留                                                                                                             |

#### 4.2.F 极值数据

| 英文               | 中文                 | 字节 | 类型 | 有效值范围 | 分辨率 | 偏移量 | 异常   | 无效   | 其他 |
| :----------------- | :------------------- | :--- | :--- | :--------- | :----- | :----- | :----- | :----- | :--- |
| maxVoltageSubSysNo | 最高电压电池子系统号 | 1    |      | 1~250      |        |        | OxFE   | OxFF   |
| maxVoltageSingNo   | 最高电压电池单体代号 | 1    |      | 1~250      |        |        | OxFE   | OxFF   |
| maxVoltage         | 电池单体电压最高值   | 2    |      | 1~15000    | 0.001V |        | OxFFFE | OxFFFF |
| minVoltageSubSysNo | 最低电压电池子系代号 | 1    |      | 1~250      |        |        | OxFE   | OxFF   |
| minVoltageSingNo   | 最低电压电池单体代号 | 1    |      | 1~250      |        |        | OxFE   | OxFF   |
| minVoltage         | 电池单体最低电压值   | 2    |      | 1~15000    | 0.001V |        | OxFFFE | OxFFFF |
| maxNtcSubSysNo     | 最高温度子系统号     | 1    |      | 1~250      |        |        | OxFE   | OxFF   |
| maxNtcNo           | 最高温度探针序号     | 1    |      | 1~250      |        |        | OxFE   | OxFF   |
| maxNtc             | 最高温度值           | 1    |      | 1~250      | 1℃     | 40     | OxFE   | OxFF   |
| minNtcSubSysNo     | 最低温度子系统号     | 1    |      | 1~250      |        |        | OxFE   | OxFF   |
| minNtcNo           | 最低温度探针序号     | 1    |      | 1~250      |        |        | OxFE   | OxFF   |
| minNtc             | 最低温度值           | 1    |      | 1~250      | 1℃     | 40     | OxFE   | OxFF   |

#### 4.2.G 报警数据

| 英文          | 中文                       | 字节  | 类型 | 有效值范围 | 分辨率 | 偏移量 | 异常 | 无效 | 其他                                                                                                                                                                                           |
| :------------ | :------------------------- | :---- | :--- | :--------- | :----- | :----- | :--- | :--- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| maxAlarmLevel | 最高报警等级               | 1     |      | 0~3        |        |        | OxFE | OxFF | """0""代表无故障，""1""表示一级故障，指代不影响车辆正常行驶的故障；""2""表示二级故障，指代影响车辆性能，需驾驶员限制行驶的故障；""3""表示三级故障，指代驾驶员应该立即停车处理或请求救援的故障" |
| uas           | 通用报警标志               | 4     |      |            |        |        | OxFE | OxFF | 通用报警标志位定义见下面定义表                                                                                                                                                                 |
| n1            | 可充电储能装置故障总数 N1  | 1     |      | 0~255      |        |        | OxFE | OxFF |
| n1List        | 可充电储能装置故障代码列表 | 4\*N  |      |            |        |        | OxFE | OxFF |
| n2            | 驱动电机故障总数 N2        | 1     |      | 0~252      |        |        | OxFE | OxFF |
| n2List        | 驱动电机故障代码列表       | 4\*N2 |      |            |        |        | OxFE | OxFF |
| n3            | 发动机故障总数 N3          | 1     |      |            |        |        | OxFE | OxFF |
| n3List        | 发动机故障列表             | 4\*N3 |      |            |        |        | OxFE | OxFF |
| n4            | 其他故障总数 N4            | 1     |      |            |        |        | OxFE | OxFF |
| n4List        | 其他故障代码列表           | 4\*N4 |      |            |        |        | OxFE | OxFF |

通用报警标志位定义

| 位    | 定义                                 | 处理说明               |
| :---- | :----------------------------------- | :--------------------- |
| 0     | 1，温度差异报警；0；正常             | 标志维持到报警条件解除 |
| 1     | 1，电池高温报警；0；正常             | 标志维持到报警条件解除 |
| 2     | 1，车载储能装置类型过压报警；0；正常 | 标志维持到报警条件解除 |
| 3     | 1，车载储能装置类型欠压报警；0；正常 | 标志维持到报警条件解除 |
| 4     | 1，SOC 低报警；0；正常               | 标志维持到报警条件解除 |
| 5     | 1，单体电池过压报警；0；正常         | 标志维持到报警条件解除 |
| 6     | 1，单体电池欠压报警；0；正常         | 标志维持到报警条件解除 |
| 7     | 1，SOC 过高报警；0；正常             | 标志维持到报警条件解除 |
| 8     | 1，SOC 跳变报警；0；正常             | 标志维持到报警条件解除 |
| 9     | 1，可储能系统不匹配报警；0；正常     | 标志维持到报警条件解除 |
| 10    | 1，电池单体一致性差报警；0；正常     | 标志维持到报警条件解除 |
| 11    | 1，绝缘报警；0；正常                 | 标志维持到报警条件解除 |
| 12    | 1，DC-DC 温度报警；0；正常           | 标志维持到报警条件解除 |
| 13    | 1，制动系统报警；0；正常             | 标志维持到报警条件解除 |
| 14    | 1，DC-DC 状态报警；0；正常"          | 标志维持到报警条件解除 |
| 15    | 1，驱动电机控制器温度报警；0；正常   | 标志维持到报警条件解除 |
| 16    | 1，高压互锁状态报警；0；正常         | 标志维持到报警条件解除 |
| 17    | 1，驱动电机温度报警；0；正常         | 标志维持到报警条件解除 |
| 18    | 1，车载储能装置类型过充；0；正常     | 标志维持到报警条件解除 |
| 19~31 | 预留                                 | 标志维持到报警条件解除 |

#### 4.H 用户自定义数据

| 数据表示内容   | 长度/字节 | 数据类型 | 描述及要求                         |
| :------------- | :-------- | :------- | :--------------------------------- |
| 自定义数据长度 | 2         | WORD     | 自定义数据长度 n，有效范围 1~65531 |
| 自定义数据     | 1\*N      | BYTE[N]  | 拓展性数据，由用户  自行定义       |

### 4.3 车辆登出

| 数据表示内容 | 长度/字节 | 数据类型 | 描述及要求                     |
| :----------- | :-------- | :------- | :----------------------------- |
| 登出时间     | 6         | BYTE[6]  | 时间定义表见上表 3.3           |
| 登出流水号   | 2         | WORD     | 登出流水号和当前登入流水号一致 |

### 4.4 平台登入

| 数据表示内容 | 长度/字节 | 数据类型 | 描述及要求                                                                                               |
| :----------- | :-------- | :------- | :------------------------------------------------------------------------------------------------------- |
| 平台登入时间 | 6         | BYTE[6]  | 时间定义表见上表 3.3                                                                                     |
| 登入流水号   | 2         | WORD     | 下级平台每登入一次，登入流水号自动加 1，从 1 开始循环累加，最大值为 65531，循环周期为一天                |
| 平台用户名   | 12        | STRING   | 平台登入用户名                                                                                           |
| 平台  密码   | 20        | STRING   | 平台登入密码                                                                                             |
| 加密规则     | 1         | BYTE     | 0x01:数据不加密；0x02:数据经过 RSA 加密；0x03:数据经过 AES128 加密；0xFE 表示异常，0xFF 表示无效其他预留 |

### 4.5 平台登出

| 数据表示内容 | 长度/字节 | 数据类型 | 描述及要求                     |
| :----------- | :-------- | :------- | :----------------------------- |
| 登出时间     | 6         | BYTE[6]  | 时间定义表见上表 3.3           |
| 登出流水号   | 2         | WORD     | 登出流水号和当前登入流水号一致 |
